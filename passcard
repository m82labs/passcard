#!/usr/bin/env python

# PassCard.py
# -*- coding: utf-8 -*-

"""
Program: PassCard is a program used to generate a card that helps the user
         create secure, easy to remember passwords.
Author:  Mark Wilkinson
Date:    2016.04.24
"""

import hashlib
import sys
import uuid
import argparse
from string import ascii_lowercase, ascii_uppercase, digits, punctuation

# Parse command line arguments
parser = argparse.ArgumentParser()
parser.add_argument("-p","--passphrase", help="Passphrase used to generate a PassCard")
parser.add_argument("-o","--output", help="File to output HTML card to.")
args = parser.parse_args()

if args.passphrase:
    passphrase = args.passphrase
else:
    passphrase = str(uuid.uuid1())

# Hash our passphrase
ph = hashlib.sha512()
ph.update(passphrase)
big_hash = str(ph.hexdigest())

# For each character we plan to print to our grid 
# (ASCII lower characters and digits) we generate
# 3 psudoe-random characters from our big_hash
grid = {}
big_hash_pos = 0
chunk_size = 4
rand_chars = 3
chars = ascii_lowercase + ascii_uppercase + punctuation + digits + ascii_lowercase + ascii_uppercase + digits
char_pool = [i for i in chars+chars if i not in ('%','&',':','"','/','\\','{','}','[',']',')','(',"'",';','.','`',',','<','>') ]

for gridpos in ascii_lowercase + digits:
    grid[gridpos] = ''
    for i in range(0,rand_chars):
        grid[gridpos] += char_pool[int(big_hash[big_hash_pos:big_hash_pos+chunk_size],16) % len(char_pool)]
        big_hash_pos += 1

# Output grid data to HTML
outHTML = """<html>
  <head>
    <title>Generated by PassCard</title>
  </head>
  <body>
    <div style="line-height:1.4em; font-family: monospace;">
{{passgrid}}
    </div>
  </body>
</html>
"""

passgrid = ''
i = 1

for c in ascii_lowercase:
    if i >= 1:
        passgrid += c + ':' + grid[c] + ' '

    if i % 5 == 0:
        passgrid += '<br/>\n'
        i = 0

    i += 1

print outHTML.replace('{{passgrid}}',passgrid)




